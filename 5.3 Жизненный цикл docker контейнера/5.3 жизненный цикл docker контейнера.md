
# Домашнее задание к занятию 3. «Введение. Экосистема. Архитектура. Жизненный цикл Docker-контейнера»


## Задача 1

Сценарий выполнения задачи:

- создайте свой репозиторий на https://hub.docker.com;
- выберите любой образ, который содержит веб-сервер Nginx;
- создайте свой fork образа;
- реализуйте функциональность:
запуск веб-сервера в фоне с индекс-страницей, содержащей HTML-код ниже:
```
<html>
<head>
Hey, Netology
</head>
<body>
<h1>I’m DevOps Engineer!</h1>
</body>
</html>
```

Создаем Dockerfile
```
vagrant@server1:~$ cat Dockerfile
FROM nginx:latest
COPY ./index.html /usr/share/nginx/html/index.html
```

Запускаем сборку образа 
```
docker build -t shlagin/nginx .
[+] Building 0.3s (7/7) FINISHED
 => [internal] load build definition from Dockerfile                                                                                                                      0.0s
 => => transferring dockerfile: 105B                                                                                                                                      0.0s
 => [internal] load .dockerignore                                                                                                                                         0.1s
 => => transferring context: 2B                                                                                                                                           0.0s
 => [internal] load metadata for docker.io/library/nginx:latest                                                                                                           0.0s
 => [internal] load build context                                                                                                                                         0.1s
 => => transferring context: 128B                                                                                                                                         0.0s
 => [1/2] FROM docker.io/library/nginx:latest                                                                                                                             0.1s
 => [2/2] COPY ./index.html /usr/share/nginx/html/index.html                                                                                                               0.1s
 => exporting to image                                                                                                                                                    0.0s
 => => exporting layers                                                                                                                                                   0.0s
 => => writing image sha256:f04690a176caebf23ac41aa74985b2f5b2448aa8af10a9136caf26f69aac2909                                                                              0.0s
 => => naming to docker.io/shlagin/nginx
```

```
vagrant@server1:~$ docker images
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
shlagin/nginx   latest    f04690a176ca   2 minutes ago   143MB
```


Опубликуйте созданный fork в своём репозитории и предоставьте ответ в виде ссылки на https://hub.docker.com/username_repo.

```
https://hub.docker.com/r/shlaginalexey/netology
```

## Задача 2

Посмотрите на сценарий ниже и ответьте на вопрос:
«Подходит ли в этом сценарии использование Docker-контейнеров или лучше подойдёт виртуальная машина, физическая машина? Может быть, возможны разные варианты?»

Детально опишите и обоснуйте свой выбор.

--

Сценарий:

- высоконагруженное монолитное Java веб-приложение;
<b>Испрользовать можно, но я так понимаю, не совсем логично. Docker позволяет запускать несколько контейнеров и распределять между ними нагрузку, а посколько приложение монолитное - этого сделать не получится. Если приложение большое - запуск большого контейнера будет происходить дольше.
Я склоняюсь к тому, что docker тут не подходит, лучше физическая машина.</b>


- Nodejs веб-приложение;
<b>Подходит, т.к. docker обеспечивает удобаство развертывания, изоляцию, масштабируемость.</b>


- мобильное приложение c версиями для Android и iOS;
<b>Поскольку для разработки приоложений на iOS и Android требуются среды разработки - Xcode и Android Studio, - docker не будет лучшем решением. </b>


- шина данных на базе Apache Kafka;
<b>Да, Docker может быть использован для развертывания и управления шиной данных на базе Apache Kafka. Docker обеспечивает изоляцию и удобство управления контейнерами, что делает его привлекательным вариантом для работы с Kafka.</b>

- Elasticsearch-кластер для реализации логирования продуктивного веб-приложения — три ноды elasticsearch, два logstash и две ноды kibana;
<b>Тоже подходит.</b>

- мониторинг-стек на базе Prometheus и Grafana;
<b>Подходит, docker обеспечивает изоляцию и удобство управления контейнерами, масштабируемость и переносимость.</b>

- MongoDB как основное хранилище данных для Java-приложения;
<b>MongoDB интрегрируется с Docker, поэтому Docker подходит.</b>

- Gitlab-сервер для реализации CI/CD-процессов и приватный (закрытый) Docker Registry.
<b>Подходит</b>

## Задача 3

- Запустите первый контейнер из образа ***centos*** c любым тегом в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера.

```
vagrant@server1:~$ docker run -it -d -v /data:/data --name centos centos
Unable to find image 'centos:latest' locally
latest: Pulling from library/centos
a1d0c7532777: Pull complete
Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177
Status: Downloaded newer image for centos:latest
c867afb9e3443323861cd984f372561bd1680f0feafca27cb8a4261386c50e3a
```

- Запустите второй контейнер из образа ***debian*** в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера.

```
vagrant@server1:/$ docker run -itd -v /data:/data --name debian debian
2bbf885401fb145aef103521420422bfb7484078aedd07aa809423c6e5424ebb
```

- Подключитесь к первому контейнеру с помощью ```docker exec``` и создайте текстовый файл любого содержания в ```/data```.

```
vagrant@server1:~$ docker exec -it 5500dd0a70e2 /bin/bash

[root@5500dd0a70e2 /]# touch /data/file_inside_centos_container
```

- Добавьте ещё один файл в папку ```/data``` на хостовой машине.

```
vagrant@server1:/$ sudo touch /data/file_inside_host
```

- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в ```/data``` контейнера.

```
root@2bbf885401fb:/# ls -lah /data/
total 8.0K
drwxr-xr-x 2 root root 4.0K Jun  1 08:25 .
drwxr-xr-x 1 root root 4.0K Jun  1 08:21 ..
-rw-r--r-- 1 root root    0 Jun  1 07:20 file_inside_centos_container
-rw-r--r-- 1 root root    0 Jun  1 08:25 file_inside_host
```

## Задача 4 (*)

Воспроизведите практическую часть лекции самостоятельно.

Соберите Docker-образ с Ansible, загрузите на Docker Hub и пришлите ссылку вместе с остальными ответами к задачам.

```
vagrant@server1:/home/ansible$ sudo git clone https://github.com/netology-code/virt-video-code
Cloning into 'virt-video-code'...
remote: Enumerating objects: 42, done.
remote: Counting objects: 100% (42/42), done.
remote: Compressing objects: 100% (33/33), done.
remote: Total 42 (delta 8), reused 28 (delta 3), pack-reused 0
Unpacking objects: 100% (42/42), 9.79 KiB | 73.00 KiB/s, done.

vagrant@server1:/home/ansible$ cd virt-video-code/

vagrant@server1:/home/ansible/virt-video-code$ ls -lah
total 36K
drwxr-xr-x 8 root root 4.0K Jun  1 09:39 .
drwxr-xr-x 3 root root 4.0K Jun  1 09:39 ..
drwxr-xr-x 8 root root 4.0K Jun  1 09:39 .git
-rw-r--r-- 1 root root 1.5K Jun  1 09:39 README.md
drwxr-xr-x 3 root root 4.0K Jun  1 09:39 ansible
drwxr-xr-x 2 root root 4.0K Jun  1 09:39 docker
drwxr-xr-x 2 root root 4.0K Jun  1 09:39 docker-compose
drwxr-xr-x 2 root root 4.0K Jun  1 09:39 terraform
drwxr-xr-x 2 root root 4.0K Jun  1 09:39 vagrant
```

Далее исправляю ошибку в Dockerfile, переименовываю ansbile -> ansible <br>
После перемещаю: 
```
vagrant@server1:/home/ansible/virt-video-code/ansible$ sudo mv ansible.cfg /home/ansible/virt-video-code/

vagrant@server1:/home/ansible/virt-video-code/docker$ sudo mv Dockerfile /home/ansible/virt-video-code/

```

Запускаю сборку:
```
vagrant@server1:/home/ansible/virt-video-code$ docker build -t shlagin/ansible .
[+] Building 169.1s (6/9)
 => [internal] load build definition from Dockerfile                                                                                                                                         0.0s
 => => transferring dockerfile: 909B                                                                                                                                                         0.0s
 => [internal] load .dockerignore                                                                                                                                                            0.0s
 => => transferring context: 2B                                                                                                                                                              0.0s
 => [internal] load metadata for docker.io/library/alpine:3.14                                                                                                                               1.4s
 => CACHED [1/5] FROM docker.io/library/alpine:3.14@sha256:0f2d5c38dd7a4f4f733e688e3a6733cb5ab1ac6e3cb4603a5dd564e5bfb80eed                                                                  0.0s
 => [internal] load build context                                                                                                                                                            0.1s
 => => transferring context: 200B                                                                                                                                                            0.0s
 => ERROR [2/5] RUN  CARGO_NET_GIT_FETCH_WITH_CLI=1 &&      apk --no-cache add sudo python3 py3-pip openssl ca-certificates sshpass openssh-client rsync git &&      apk --no-cache add    167.6s
------

```

Дальше этой ошибки я продвинуться не смог.
Скажите пожалуйста, что я делаю неправильно?



